<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Absensi SMPN 38 MT</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; background: #f0f2f5; -webkit-tap-highlight-color: transparent; }
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid #2563eb; border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        /* Hide Scrollbar */
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Animasi Transisi Halaman */
        .fade-in { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-gray-100 min-h-screen text-gray-800 flex flex-col items-center py-0 md:py-8">

<script>
    // *** TEMPEL URL WEB APP DARI GOOGLE APPS SCRIPT DI SINI ***
    const API_URL = "https://script.google.com/macros/s/AKfycbzlY4kPg5oIZY_yuYIlJUi1MdRJkQ05edFKApcwweqP-J4QQYTCrE8Wo_s-UEOPqfdB_Q/exec";
    const ADMIN_PASS = "smpn38mt";
</script>

<div class="w-full md:max-w-5xl bg-white md:rounded-3xl shadow-xl min-h-screen md:min-h-[90vh] relative overflow-hidden flex flex-col">

    <div class="bg-blue-600 p-6 md:px-10 md:py-8 rounded-b-[2.5rem] md:rounded-b-[3rem] shadow-lg z-10 relative shrink-0">
        <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
            
            <div class="flex items-center gap-4">
                <div class="shrink-0">
                    <img src="https://iili.io/fuQdpcX.png" alt="Logo SMPN 38" class="w-16 h-16 md:w-20 md:h-20 object-contain filter drop-shadow-md">
                </div>
                <div class="text-white">
                    <h1 class="text-xl md:text-2xl font-bold leading-tight">SMP NEGERI 38</h1>
                    <p class="text-blue-100 text-sm font-medium tracking-wide">Maluku Tengah</p>
                </div>
            </div>

            <div class="flex justify-between md:justify-end items-end md:items-center gap-4 mt-2 md:mt-0">
                <div class="md:text-right">
                    <p class="text-blue-200 text-[10px] md:text-xs uppercase tracking-wider mb-1">Hari ini</p>
                    <span id="tgl-hari-ini" class="bg-white/10 backdrop-blur-md border border-white/20 px-3 py-1.5 rounded-lg text-xs md:text-sm text-white font-medium shadow-sm">...</span>
                </div>
                <button onclick="logout()" id="btn-logout" class="hidden text-xs md:text-sm bg-red-500 hover:bg-red-600 transition px-4 py-2 rounded-lg text-white font-bold shadow-md flex items-center gap-2">
                    Keluar <span class="font-sans">‚Ü™</span>
                </button>
            </div>
        </div>
    </div>

    <div id="loading" class="hidden absolute inset-0 bg-white/80 z-50 flex flex-col items-center justify-center backdrop-blur-sm">
        <div class="loader mb-4"></div>
        <p class="text-gray-600 text-sm font-medium animate-pulse">Sedang Memproses...</p>
    </div>

    <div class="flex-1 overflow-y-auto no-scrollbar relative">
        
        <div id="page-login" class="p-8 md:p-12 fade-in max-w-lg mx-auto mt-10 md:mt-20">
            <div class="text-center mb-10">
                <h2 class="text-2xl md:text-3xl font-bold text-gray-800">Login Admin</h2>
                <p class="text-gray-400 text-sm mt-2">Silakan masukkan kode akses sekolah</p>
            </div>
            <div class="bg-gray-50 p-2 rounded-2xl border border-gray-200 focus-within:ring-4 focus-within:ring-blue-100 focus-within:border-blue-500 transition shadow-inner">
                <input type="password" id="pass-input" placeholder="Kode Akses..." class="w-full p-4 bg-transparent outline-none text-center text-xl tracking-[0.3em] font-bold text-gray-700">
            </div>
            <button onclick="login()" class="w-full bg-blue-600 text-white p-4 rounded-2xl font-bold shadow-lg hover:bg-blue-700 hover:shadow-blue-500/30 transition transform active:scale-[0.98] mt-6 text-lg">MASUK APLIKASI</button>
        </div>

        <div id="page-dashboard" class="hidden p-6 md:p-10 fade-in h-full flex flex-col justify-center md:justify-start">
            <p class="text-gray-500 text-sm font-bold uppercase tracking-widest mb-6 border-b pb-2">Menu Utama</p>
            
            <div class="grid grid-cols-1 md:grid-cols-3 gap-5 md:gap-8">
                
                <div onclick="bukaAbsen()" class="bg-white p-6 md:p-8 rounded-3xl shadow-sm border border-gray-100 cursor-pointer hover:shadow-xl hover:-translate-y-1 transition-all duration-300 group relative overflow-hidden">
                    <div class="absolute right-0 top-0 w-24 h-24 bg-blue-50 rounded-bl-full -mr-4 -mt-4 transition group-hover:bg-blue-100"></div>
                    <div class="relative z-10 flex md:flex-col items-center md:items-start gap-4 md:gap-6">
                        <div class="bg-blue-100 p-4 rounded-2xl text-blue-600 text-2xl md:text-4xl group-hover:scale-110 transition">üìù</div>
                        <div>
                            <h3 class="font-bold text-lg md:text-xl text-gray-800">Input Absensi</h3>
                            <p class="text-xs md:text-sm text-gray-500 mt-1">Isi kehadiran guru harian</p>
                        </div>
                    </div>
                </div>

                <div onclick="bukaRekap()" class="bg-white p-6 md:p-8 rounded-3xl shadow-sm border border-gray-100 cursor-pointer hover:shadow-xl hover:-translate-y-1 transition-all duration-300 group relative overflow-hidden">
                    <div class="absolute right-0 top-0 w-24 h-24 bg-purple-50 rounded-bl-full -mr-4 -mt-4 transition group-hover:bg-purple-100"></div>
                    <div class="relative z-10 flex md:flex-col items-center md:items-start gap-4 md:gap-6">
                        <div class="bg-purple-100 p-4 rounded-2xl text-purple-600 text-2xl md:text-4xl group-hover:scale-110 transition">üìä</div>
                        <div>
                            <h3 class="font-bold text-lg md:text-xl text-gray-800">Laporan Absensi</h3>
                            <p class="text-xs md:text-sm text-gray-500 mt-1">Rekapitulasi data & Statistik</p>
                        </div>
                    </div>
                </div>

                <div onclick="bukaGuru()" class="bg-white p-6 md:p-8 rounded-3xl shadow-sm border border-gray-100 cursor-pointer hover:shadow-xl hover:-translate-y-1 transition-all duration-300 group relative overflow-hidden">
                    <div class="absolute right-0 top-0 w-24 h-24 bg-orange-50 rounded-bl-full -mr-4 -mt-4 transition group-hover:bg-orange-100"></div>
                    <div class="relative z-10 flex md:flex-col items-center md:items-start gap-4 md:gap-6">
                        <div class="bg-orange-100 p-4 rounded-2xl text-orange-600 text-2xl md:text-4xl group-hover:scale-110 transition">üë•</div>
                        <div>
                            <h3 class="font-bold text-lg md:text-xl text-gray-800">Data Guru</h3>
                            <p class="text-xs md:text-sm text-gray-500 mt-1">Kelola daftar nama guru</p>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <div id="page-absen" class="hidden p-6 md:p-10 fade-in">
            <button onclick="nav('page-dashboard')" class="mb-6 text-sm text-gray-500 hover:text-blue-600 flex items-center gap-2 font-medium transition hover:-translate-x-1">
                <span class="text-xl">‚Üê</span> Kembali ke Menu
            </button>
            
            <div class="bg-white p-6 md:p-8 rounded-3xl shadow-sm border border-gray-100">
                <h2 class="text-2xl font-bold mb-6 text-gray-800 border-b pb-4">Form Absensi Harian</h2>

                <form id="form-absen">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-10">
                        
                        <div class="space-y-5">
                            <div>
                                <label class="text-xs font-bold text-gray-500 uppercase tracking-wider ml-1">Tanggal</label>
                                <input type="date" id="input-date" class="w-full p-4 border border-gray-200 rounded-xl mt-2 bg-gray-50 focus:bg-white focus:ring-2 focus:ring-blue-500 outline-none transition cursor-pointer">
                            </div>
                            <div>
                                <label class="text-xs font-bold text-gray-500 uppercase tracking-wider ml-1">Nama Guru</label>
                                <div class="relative mt-2">
                                    <select id="input-guru" class="w-full p-4 border border-gray-200 rounded-xl bg-white appearance-none focus:ring-2 focus:ring-blue-500 outline-none transition cursor-pointer" required>
                                        <option value="">Pilih...</option>
                                    </select>
                                    <div class="absolute right-4 top-1/2 transform -translate-y-1/2 pointer-events-none text-gray-400">‚ñº</div>
                                </div>
                            </div>
                        </div>

                        <div class="space-y-5">
                            <div>
                                <label class="text-xs font-bold text-gray-500 uppercase tracking-wider ml-1 mb-2 block">Status Kehadiran</label>
                                <div class="grid grid-cols-4 gap-3">
                                    <label class="cursor-pointer relative group">
                                        <input type="radio" name="status" value="Hadir" class="peer sr-only" required>
                                        <div class="p-3 border rounded-xl bg-white text-center hover:bg-gray-50 peer-checked:bg-green-100 peer-checked:border-green-500 peer-checked:text-green-700 transition h-full flex flex-col justify-center items-center shadow-sm">
                                            <span class="text-xl mb-1 group-hover:scale-110 transition">‚úÖ</span>
                                            <span class="text-[10px] md:text-xs font-bold">Hadir</span>
                                        </div>
                                    </label>
                                    <label class="cursor-pointer relative group">
                                        <input type="radio" name="status" value="Sakit" class="peer sr-only">
                                        <div class="p-3 border rounded-xl bg-white text-center hover:bg-gray-50 peer-checked:bg-red-100 peer-checked:border-red-500 peer-checked:text-red-700 transition h-full flex flex-col justify-center items-center shadow-sm">
                                            <span class="text-xl mb-1 group-hover:scale-110 transition">ü§í</span>
                                            <span class="text-[10px] md:text-xs font-bold">Sakit</span>
                                        </div>
                                    </label>
                                    <label class="cursor-pointer relative group">
                                        <input type="radio" name="status" value="Izin" class="peer sr-only">
                                        <div class="p-3 border rounded-xl bg-white text-center hover:bg-gray-50 peer-checked:bg-yellow-100 peer-checked:border-yellow-500 peer-checked:text-yellow-700 transition h-full flex flex-col justify-center items-center shadow-sm">
                                            <span class="text-xl mb-1 group-hover:scale-110 transition">üì©</span>
                                            <span class="text-[10px] md:text-xs font-bold">Izin</span>
                                        </div>
                                    </label>
                                    <label class="cursor-pointer relative group">
                                        <input type="radio" name="status" value="Alpha" class="peer sr-only">
                                        <div class="p-3 border rounded-xl bg-white text-center hover:bg-gray-50 peer-checked:bg-gray-200 peer-checked:border-gray-500 peer-checked:text-gray-700 transition h-full flex flex-col justify-center items-center shadow-sm">
                                            <span class="text-xl mb-1 group-hover:scale-110 transition">‚ùå</span>
                                            <span class="text-[10px] md:text-xs font-bold">Alpha</span>
                                        </div>
                                    </label>
                                </div>
                            </div>
                            <div>
                                <label class="text-xs font-bold text-gray-500 uppercase tracking-wider ml-1">Catatan</label>
                                <textarea id="input-catatan" placeholder="Keterangan tambahan (Opsional)..." class="w-full p-4 border border-gray-200 rounded-xl mt-2 bg-gray-50 focus:bg-white focus:ring-2 focus:ring-blue-500 outline-none transition text-sm h-24 resize-none"></textarea>
                            </div>
                        </div>
                    </div>
                    
                    <button type="submit" class="w-full bg-gradient-to-r from-blue-600 to-blue-500 text-white py-4 md:py-5 rounded-xl font-bold text-lg hover:shadow-xl hover:shadow-blue-500/30 active:scale-[0.99] transition mt-8">KIRIM DATA ABSENSI</button>
                </form>
            </div>
        </div>

        <div id="page-guru" class="hidden p-6 md:p-10 fade-in">
            <button onclick="nav('page-dashboard')" class="mb-6 text-sm text-gray-500 hover:text-blue-600 flex items-center gap-2 font-medium transition hover:-translate-x-1">
                <span class="text-xl">‚Üê</span> Kembali ke Menu
            </button>
            
            <div class="max-w-2xl mx-auto">
                <h2 class="text-2xl font-bold mb-6 text-gray-800">Kelola Data Guru</h2>
                <div class="bg-white p-4 rounded-2xl shadow-sm border border-gray-100 mb-6 flex gap-3">
                    <input type="text" id="nama-baru" placeholder="Tulis Nama Guru Baru..." class="flex-1 p-3 border-b-2 border-transparent focus:border-green-500 outline-none bg-transparent transition">
                    <button onclick="tambahGuru()" class="bg-green-600 text-white px-6 rounded-xl font-bold hover:bg-green-700 transition shadow-lg shadow-green-200 hover:-translate-y-0.5 active:translate-y-0">Tambah +</button>
                </div>
                <div id="list-guru" class="space-y-3 max-h-[500px] overflow-y-auto pr-2 pb-10"></div>
            </div>
        </div>

        <div id="page-rekap" class="hidden p-6 md:p-10 fade-in">
            <button onclick="nav('page-dashboard')" class="mb-6 text-sm text-gray-500 hover:text-blue-600 flex items-center gap-2 font-medium transition hover:-translate-x-1">
                <span class="text-xl">‚Üê</span> Kembali ke Menu
            </button>
            
            <div class="flex flex-col md:flex-row md:items-center justify-between mb-6 gap-4">
                <h2 class="text-2xl font-bold text-gray-800">Laporan Absensi</h2>
                
                <div class="bg-gray-100 p-1 rounded-full inline-flex self-start md:self-auto overflow-x-auto max-w-full">
                    <button onclick="tarikData('minggu')" class="filter-btn px-4 py-1.5 rounded-full text-xs md:text-sm font-medium transition whitespace-nowrap">Minggu Ini</button>
                    <button onclick="tarikData('bulan')" class="filter-btn px-4 py-1.5 rounded-full text-xs md:text-sm font-medium transition whitespace-nowrap">Bulan Ini</button>
                    <button onclick="tarikData('semester')" class="filter-btn px-4 py-1.5 rounded-full text-xs md:text-sm font-medium transition whitespace-nowrap">Semester</button>
                </div>
            </div>

            <div id="rekap-stats" class="grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-6 mb-8 text-center"></div>

            <div class="bg-white rounded-2xl shadow-sm border border-gray-200 overflow-hidden">
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left">
                        <thead class="bg-gray-50 text-gray-600 uppercase tracking-wider border-b font-bold text-xs">
                            <tr>
                                <th class="p-4 sticky left-0 bg-gray-50 z-10 min-w-[150px]">Nama Guru</th>
                                <th class="p-4 text-center text-green-600 w-20">Hadir</th>
                                <th class="p-4 text-center text-red-600 w-20">Sakit</th>
                                <th class="p-4 text-center text-yellow-600 w-20">Izin</th>
                                <th class="p-4 text-center text-gray-600 w-20">Alpha</th>
                            </tr>
                        </thead>
                        <tbody id="rekap-body" class="divide-y divide-gray-100"></tbody>
                    </table>
                </div>
            </div>
        </div>

    </div>
</div>

<script>
    // --- DATA AWAL ---
    const DEFAULT_GURUS = [
        "Abraham Kaya", "Agusthin M. Amarmolo", "Annete Noya", "Astrid Ohello",
        "Christina E. Wenno", "Costafina Hatalaibessy", "David Talakua", "Elieser Wattimena",
        "Elisabeth Bakker", "Jhon Glenty Payong", "Johana J. Suitella", "Kotje N. Waelauruw",
        "Lebrina Liptiay", "Liberatus Reressy", "Marce A. Soukotta", "Marice D. Tuapattinaya",
        "Marisa Komul", "Marthen R. Ririmase", "Meilany Matulessy", "Novita Sari Pranoko",
        "Nurhayati", "Ridwan Tomagola", "Vector Izaac"
    ];
    let teachers = JSON.parse(localStorage.getItem('guru_smp38')) || DEFAULT_GURUS;

    // --- NAVIGASI ---
    function nav(id) {
        document.querySelectorAll('[id^="page-"]').forEach(el => {
            el.classList.add('hidden');
            el.classList.remove('fade-in'); // Reset animasi
        });
        const target = document.getElementById(id);
        target.classList.remove('hidden');
        // Trigger reflow agar animasi jalan ulang
        void target.offsetWidth; 
        target.classList.add('fade-in');
        
        // Auto scroll ke atas content
        const contentArea = document.querySelector('.overflow-y-auto');
        if(contentArea) contentArea.scrollTop = 0;
    }

    function login() {
        if(document.getElementById('pass-input').value === ADMIN_PASS) {
            nav('page-dashboard');
            document.getElementById('btn-logout').classList.remove('hidden');
            init();
        } else { 
            alert('‚ùå Password Salah!'); 
            document.getElementById('pass-input').value = '';
            document.getElementById('pass-input').focus();
        }
    }

    function logout() {
        if(confirm("Yakin ingin keluar aplikasi?")) {
            location.reload();
        }
    }

    function init() {
        const options = { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' };
        document.getElementById('tgl-hari-ini').innerText = new Date().toLocaleDateString('id-ID', options);
        renderGuruSelect();
    }

    // --- FITUR GURU ---
    function bukaGuru() {
        nav('page-guru');
        renderListGuru();
    }

    function renderGuruSelect() {
        const sel = document.getElementById('input-guru');
        sel.innerHTML = '<option value="">Pilih Nama Guru...</option>' + teachers.sort().map(t => `<option value="${t}">${t}</option>`).join('');
    }

    function renderListGuru() {
        const div = document.getElementById('list-guru');
        div.innerHTML = teachers.sort().map(t => `
            <div class="flex justify-between items-center bg-white p-4 rounded-xl shadow-sm border border-gray-100 hover:shadow-md transition group">
                <span class="text-sm md:text-base font-medium text-gray-700">${t}</span>
                <button onclick="hapusGuru('${t}')" class="text-red-400 hover:text-red-600 transition p-2 opacity-50 group-hover:opacity-100">üóë Hapus</button>
            </div>
        `).join('');
    }

    function tambahGuru() {
        const nama = document.getElementById('nama-baru').value.trim();
        if(nama && !teachers.includes(nama)) {
            teachers.push(nama);
            localStorage.setItem('guru_smp38', JSON.stringify(teachers));
            document.getElementById('nama-baru').value = '';
            renderListGuru(); renderGuruSelect();
        } else { alert('Nama kosong atau sudah ada!'); }
    }

    function hapusGuru(nama) {
        if(confirm('Hapus ' + nama + ' dari daftar?')) {
            teachers = teachers.filter(t => t !== nama);
            localStorage.setItem('guru_smp38', JSON.stringify(teachers));
            renderListGuru(); renderGuruSelect();
        }
    }

    // --- FITUR ABSEN ---
    function bukaAbsen() {
        nav('page-absen');
        document.getElementById('input-date').valueAsDate = new Date();
    }

    document.getElementById('form-absen').addEventListener('submit', e => {
        e.preventDefault();
        if(API_URL.includes("TEMPEL_URL")) return alert("URL Script belum dipasang di kode!");
        
        document.getElementById('loading').classList.remove('hidden');

        const payload = {
            date: document.getElementById('input-date').value,
            teacher_name: document.getElementById('input-guru').value,
            status: document.querySelector('input[name="status"]:checked').value,
            notes: document.getElementById('input-catatan').value
        };

        fetch(API_URL, {
            method: "POST",
            body: JSON.stringify(payload)
        })
        .then(res => res.json())
        .then(res => {
            document.getElementById('loading').classList.add('hidden');
            alert("‚úÖ Data Berhasil Disimpan!");
            document.getElementById('form-absen').reset();
            document.getElementById('input-date').valueAsDate = new Date();
        })
        .catch(err => {
            document.getElementById('loading').classList.add('hidden');
            alert("‚úÖ Data Terkirim (Silakan cek di Spreadsheet)."); 
            document.getElementById('form-absen').reset();
        });
    });

    // --- FITUR REKAP ---
    function bukaRekap() {
        nav('page-rekap');
        // Default load null/empty or prompt user to click filter
        document.getElementById('rekap-body').innerHTML = `<tr><td colspan="5" class="p-8 text-center text-gray-400">Silakan pilih filter waktu di atas untuk memuat data.</td></tr>`;
    }

    function tarikData(filterType) {
        if(API_URL.includes("TEMPEL_URL")) return alert("URL Script belum dipasang!");

        document.getElementById('loading').classList.remove('hidden');
        
        // Reset styles tombol filter
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.className = "filter-btn px-4 py-1.5 rounded-full text-xs md:text-sm font-medium transition whitespace-nowrap bg-transparent text-gray-500 hover:bg-gray-200";
        });
        const activeBtn = document.querySelector(`button[onclick="tarikData('${filterType}')"]`);
        if(activeBtn) {
            activeBtn.className = "filter-btn px-4 py-1.5 rounded-full text-xs md:text-sm font-medium transition whitespace-nowrap bg-blue-600 text-white shadow-md";
        }

        fetch(API_URL + "?action=read")
        .then(res => res.json())
        .then(data => {
            document.getElementById('loading').classList.add('hidden');
            prosesRekap(data, filterType);
        })
        .catch(err => {
            document.getElementById('loading').classList.add('hidden');
            alert("Gagal mengambil data. Pastikan internet lancar.\nError: " + err);
        });
    }

    function prosesRekap(data, type) {
        let filtered = [];
        const now = new Date();
        
        if(type === 'minggu') {
            const d = new Date(); d.setDate(d.getDate()-7);
            filtered = data.filter(r => new Date(r.date) >= d);
        } else if(type === 'bulan') {
            filtered = data.filter(r => new Date(r.date).getMonth() === now.getMonth() && new Date(r.date).getFullYear() === now.getFullYear());
        } else if(type === 'semester') {
            const isGenap = now.getMonth() < 6;
            filtered = data.filter(r => {
                const date = new Date(r.date);
                const m = date.getMonth();
                const y = date.getFullYear();
                if(y !== now.getFullYear()) return false;
                return (isGenap ? m < 6 : m >= 6);
            });
        }

        const stats = {Hadir:0, Sakit:0, Izin:0, Alpha:0};
        const guruStats = {};
        teachers.forEach(t => guruStats[t] = {H:0, S:0, I:0, A:0});

        filtered.forEach(r => {
            const statusCapitalized = r.status.charAt(0).toUpperCase() + r.status.slice(1).toLowerCase();
            if(stats[statusCapitalized] !== undefined) stats[statusCapitalized]++;
            
            if(guruStats[r.teacher_name]) {
                const map = {Hadir:'H', Sakit:'S', Izin:'I', Alpha:'A'};
                const code = map[statusCapitalized];
                if(code) guruStats[r.teacher_name][code]++;
            }
        });

        // Update Cards
        const colorMap = {
            Hadir:'text-green-600 bg-green-50 border-green-100', 
            Sakit:'text-red-600 bg-red-50 border-red-100', 
            Izin:'text-yellow-600 bg-yellow-50 border-yellow-100', 
            Alpha:'text-gray-600 bg-gray-50 border-gray-200'
        };
        
        document.getElementById('rekap-stats').innerHTML = Object.entries(stats).map(([k,v]) => `
            <div class="p-4 border rounded-2xl shadow-sm ${colorMap[k]} flex flex-col items-center justify-center transition hover:scale-105">
                <div class="font-bold text-2xl md:text-3xl mb-1">${v}</div>
                <div class="text-[10px] md:text-xs uppercase font-bold tracking-wider opacity-80">${k}</div>
            </div>
        `).join('');

        // Update Table
        document.getElementById('rekap-body').innerHTML = Object.entries(guruStats).map(([n, s]) => `
            <tr class="hover:bg-blue-50 transition border-b last:border-0 group">
                <td class="p-4 font-medium text-gray-700 bg-white sticky left-0 group-hover:bg-blue-50 transition shadow-[2px_0_5px_-2px_rgba(0,0,0,0.05)] md:shadow-none">${n}</td>
                <td class="p-4 text-center ${s.H > 0 ? 'text-green-700 font-bold bg-green-50/50' : 'text-gray-300'}">${s.H}</td>
                <td class="p-4 text-center ${s.S > 0 ? 'text-red-700 font-bold bg-red-50/50' : 'text-gray-300'}">${s.S}</td>
                <td class="p-4 text-center ${s.I > 0 ? 'text-yellow-700 font-bold bg-yellow-50/50' : 'text-gray-300'}">${s.I}</td>
                <td class="p-4 text-center ${s.A > 0 ? 'text-gray-700 font-bold bg-gray-100' : 'text-gray-300'}">${s.A}</td>
            </tr>
        `).join('');
        
        if(filtered.length === 0) {
            document.getElementById('rekap-body').innerHTML = `<tr><td colspan="5" class="p-8 text-center text-gray-400 italic">Tidak ada data untuk periode ini.</td></tr>`;
        }
    }
</script>
</body>
</html>